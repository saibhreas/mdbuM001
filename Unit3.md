# Unit3 Creating and Manipulating Documents

mongo mongo "mongodb+srv://<username>:<password>@<cluster>.mongodb.net/admin"

    mongo "mongodb+srv://m001-student:m001-mongodb-basics@sandbox.tbzlc.mongodb.net/firstCert"

For this exercise connect to you Mongo DB Atlas Sandbox
## Inserting New Documents

  1. [ObjectID](#objectIDn)
  2. [Insert()&Errors](#insert()&Errors)
  3. [Insert()&Order](#insert()&Order)
  4. [Update](#update)
  5. [Delete](#delete)

##  ObjectID

**from https://docs.mongodb.com/manual/reference/method/ObjectId/

> ObjectId
   >Description
   >ObjectId(<hexadecimal>)
      >Returns a new ObjectId value. The 12-byte ObjectId value consists of:
      >a 4-byte timestamp value, representing the ObjectId's creation, measured in seconds since the Unix epoch 
      >a 5-byte random value
      >a 3-byte incrementing counter, initialized to a random value
   >While the BSON format itself is little-endian, the timestamp and counter values are big-endian, with the most significant bytes appearing first in the byte sequence.

***_id***  
   
   unique identifier for a document collection (generated upon creation)

   mandatory field in every document

   by default it is of the *type* ObjectId() unless otherwise specified

### Quiz: ObjectId

Problem:

How does the value of _id get assigned to a document?

   You can select an ObjectID as long as it is unique

   The system will automatically generate one if not specified


## Insert()&Errors

for this exercise 

      use sample_training


** from: https://docs.mongodb.com/manual/reference/method/db.collection.insert/

   The insert() method has the following syntax:

      db.collection.insert(
         <document or array of documents>,
       {
        writeConcern: <document>,
        ordered: <boolean>
       }
      )

   Document is a single document or an array

   *writeConcern* is an optional document, specifically overriding the default write operations behavior for a document or array, like adding a 'write time out' to stop the process.

   Fiels can contain:
      { w: <value>, j: <boolean>, wtimeout: <number> }

Mongo DB allows for multiple identical documents as long as they have unique "_id"

MogoDB schema validation allows you to enforce document structure


1. Get a random document from a collection

         db.inspections.findOne();

2. Copy this random document, and insert it back to the collection. Do you get a "Duplicate Key" error?

Yes: The insertion did not succeed because a document with this exact ID value already exists.

         db.inspections.insert({
            "_id" : ObjectId("56d61033a378eccde8a8354f"),
            "id" : "10021-2015-ENFO",
            "certificate_number" : 9278806,
            "business_name" : "ATLIXCO DELI GROCERY INC.",
            "date" : "Feb 20 2015",
            "result" : "No Violation Issued",
            "sector" : "Cigarette Retail Dealer - 127",
            "address" : {
              "city" : "RIDGEWOOD",
              "zip" : 11385,
              "street" : "MENAHAN ST",
              "number" : 1712
               }
           })


         db.inspections.insert({
            "id" : "10021-2015-ENFO",
            "certificate_number" : 9278806,
            "business_name" : "ATLIXCO DELI GROCERY INC.",
            "date" : "Feb 20 2015",
            "result" : "No Violation Issued",
            "sector" : "Cigarette Retail Dealer - 127",
            "address" : {
              "city" : "RIDGEWOOD",
              "zip" : 11385,
              "street" : "MENAHAN ST",
              "number" : 1712
            }
         })


         db.inspections.find({"id" : "10021-2015-ENFO", "certificate_number" : 9278806}).pretty()

***Removing the whole collection before inserting it back eliminates the duplicate key issue***

3. Insert that document into the collection without the _id field to get a successfull insert. Did it work?

Yes, a new identical document is created with a new unique ObjectId generated by the database

## Insert()&Order

***ORDER MATTERS***



### Quiz: Insert Order

Problem:

Which of the following commands will successfully insert 3 new documents into an empty pets collection?

      db.pets.insert({{ "pet": "cat"},{"pet": "dog"},{"pet": "fish"}})
      //correct- enters all 3 documents to the pets collection


      db.pets.insert([{ "_id": 1, "pet": "cat" },
                { "_id": 1, "pet": "dog" },
                { "_id": 3, "pet": "fish" },
                { "_id": 4, "pet": "snake" }], { "ordered": false })
      // Adds cat, fish,  && snake because of ***ordered:false***.  However, you will not be notified that dog was not inserted

      db.pets.insert([{ "_id": 1, "pet": "cat" },
                { "_id": 2, "pet": "dog" },
                { "_id": 3, "pet": "fish" },
                { "_id": 3, "pet": "snake" })
      // First 3 documents will be inserted. Duplicate will cause an error, but because it happens at the end(order) does not throw error before first 3 are written

## Update

For this lesson 

      use sample_training
Grades Collection contains an array field

Update student *"student_id:0"* record for the *"class:339"*

In Atlas: update one document, select the edit button that looks like a pencil.

### Quiz: Updating Documents- Atlas

Problem:

MongoDB has a flexible data model, which means that you can have fields that contain documents, or arrays as their values.

Select any invalid MongoDB documents from the given choices:

*NONE OF THE ABOVE* All choices were valid 

## Updating Documents- mongo shell



Inserting New Documents - insert() order:

1. Insert three test documents into the inspections collection
   db.inspections.insert([{"test":1},{"test":2},{"test":3}])
2. Insert the same three documents into the inspections collection. Did it
   work? Why?
3. Insert these three test documents into the inspections collection. Did it
   work? Why?
   db.inspections.insert([{"_id": 1, "test": 1},{"_id": 1, "test": 2},{"_id": 3,"test": 3}])
4. Try the same insert as above but make it unordered.
5. Try this command. Did it work? Why?
   db.inspection.insert([{ "_id":1, "test": 1 },{ "_id": 3,"test": 3 }])


Updating Documents  - mongo shell

1. Find all documents in the zips collection where the zip field is equal to
   12434.
2. Find all documents in the zips collection where the city field is equal to
   "HUDSON".
3. Find how many documents in the zips collection have the city field is equal
   to "HUDSON".
4. Update all documents in the zips collection where the city field is equal
   to "HUDSON" by adding 10 to the current value of the "pop" field.
5. Update a single document in the zips collection where the zip field is
   equal to 12534 by setting the value of the "pop" field to 17630.
6. Update a single document in the zips collection where the zip field is
   equal to 12534 by setting the value of the "population" field to 17630.
7. Find all documents in the grades collection where the student_id is 151,
   and the class_id field is 339.
8. Find all documents in the grades collection where the student_id is 250,
   and the class_id field is 339.
9. Update one document in the grades collection where the student_id is 250,
   and the class_id field is 339, by adding a document element to the "scores"
   array.

Practice Question:

People often confuse NEW YORK City as the capital of New York state, when in
reality the capital of New York state is ALBANY.

Add a boolean field "capital?" to all documents pertaining to ALBANY NY, and
NEW YORK, NY. The value of the field should be true for all ALBANY documents
and false for all NEW YORK documents.


Deleting Documents and Collections

1. Look at all the documents in the inspections collection that have test field
   equal to 1.
2. Look at all the documents in the inspections collection that have test field
   equal to 3.
3. Delete all the documents from the inspections collection that have test
   field equal to 1
4. Delete one document from the inspections collection that has test field
   equal to 3
5. Inspect what is left of the inspection collection.
6. View what collections are present in the sample_training database.
7. Drop the inspection collection
